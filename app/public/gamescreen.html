<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Gamescreen</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <h1 id="gametitle"></h1>

    <p>Welcome to the game!</p>

    <p id="maptitle"></p>

    <canvas id="map">

    </canvas>


</body>

<script>
    let gametitle = document.getElementById("gametitle");
    let maptitle = document.getElementById("maptitle");
    let map = document.getElementById("map");
    const gl = map.getContext("webgl");
    let factorySprite = new Image();
    let fieldSprite = new Image();
    factorySprite.src = ".\\sprites\\neutralfactory.png";
    fieldSprite.src = ".\\sprites\\field.png";
    render(factorySprite);
    if (gl === null){
        console.log("No GL");
    }
    let querystring = window.location.href.slice(32)
    console.log(querystring);
    let gamedata;
    fetch("/game" + querystring, {
        method: "GET"
    }).then(response => {
        console.log("game fetched");
        return response.json();
    }).then(body => {
    if (body.rows.length <= 0){
            console.log("No game found")
        } else {
            gametitle.textContent=body.rows[0].title;
            gamedata = body.rows[0];
            console.log(body.rows[0]);
        }

    });

    fetch("/map" + querystring, {
        method: "GET"
    }).then(response => {
        console.log("map fetched");
        return response.json();
    }).then(body => {
        if (body.rows.length <= 0){
            console.log("No game found")
        } else {
            maptitle.textContent = body.rows[0].title;
            console.log(body.rows[0]);
            map.width = body.rows[0].width * 64;
            map.height = body.rows[0].height * 64;        
            // Set clear color to black, fully opaque
            gl.clearColor(0.0, 0.0, 0.0, 1.0);
            // Clear the color buffer with specified clear color
            gl.clear(gl.COLOR_BUFFER_BIT);

        }
    })


</script>
</html>
